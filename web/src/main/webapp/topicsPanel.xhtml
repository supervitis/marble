<!DOCTYPE html [
    <!ENTITY ldquo  "&#147;"> <!-- Left Double Quote --> 
    <!ENTITY laquo "&#171;"> <!-- left pointing guillemet -->
    <!ENTITY raquo "&#187;"> <!-- right pointing guillemet -->
    <!ENTITY rdquo  "&#148;"> <!-- Right Double Quote -->
    <!ENTITY trade  "&#153;"> <!-- Trademark Symbol (TM) -->
    <!ENTITY rtrade "&#174;"> <!-- Registered Trademark (R) -->
    <!ENTITY copy  "&#169;"> <!-- Copyright Symbol --> 
]>
<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	template="/WEB-INF/templates/layout.xhtml"
	xmlns:p="http://primefaces.org/ui">
	<ui:define name="content">
		<div class="row">
			<div class="col-lg-12">
				<h1 class="page-header">Topics Dashboard</h1>
			</div>
			<!-- /.col-lg-12 -->
		</div>

		<div class="row topics-panel">
			<div class="col-lg-12">
				<div class="panel panel-default">
					<div class="panel-heading">Topics</div>
					<!-- /.panel-heading -->

					<div class="panel-body">
						<div class="table-responsive">
							<h:messages styleClass="messages"
								errorClass="center-block alert alert-warning"
								infoClass="center-block alert alert-success"
								warnClass="center-block alert alert-warning" globalOnly="true" />
							<h:panelGroup rendered="#{empty topicList}">
								<em class="alert alert-warning">No registered topics.</em>
							</h:panelGroup>
							<h:dataTable var="_topic" value="#{topicList}"
								rendered="#{not empty topicList}"
								styleClass="table data-table table-striped table-bordered table-hover">
								<h:column>
									<f:facet name="header">Name</f:facet>
									<h:link styleClass="name" value="#{_topic.name}"
										outcome="topic.xhtml?name=#{_topic.name}" />
								</h:column>
								<h:column>
									<f:facet name="header">Extractor Status</f:facet>
									<h:outputText id="extractorStatus"
										value="#{progressController.progressMap[_topic.name.concat('|extractor')]}" />
								</h:column>
								<h:column>
									<f:facet name="header">Last Extractor Message</f:facet>
									<h:outputText styleClass="text-info"
										value="#{_topic.topicStatus.extractorStatus}" />
								</h:column>
								<h:column>
									<f:facet name="header">Processor Status</f:facet>
									<h:outputText id="processorStatus"
										value="#{progressController.progressMap[_topic.name.concat('|processor')]}" />
								</h:column>
								<h:column>
									<f:facet name="header">Last Processor Message</f:facet>
									<h:outputText styleClass="text-info"
										value="#{_topic.topicStatus.processStatus}" />
								</h:column>
								<h:column>
									<f:facet name="header">Actions</f:facet>
									<h:form id="actions" role="form">
										<div>
											<h:commandButton id="extract"
												action="#{extractorController.extract(_topic)}"
												value="Extract" styleClass="btn btn-default" />
											<h:commandButton id="extractStop"
												action="#{extractorController.requestStop(_topic)}"
												value="Stop Extract" styleClass="btn btn-default" />
											<h:commandButton id="process"
												action="#{processorController.process(_topic)}"
												value="Process" styleClass="btn btn-default" />
											<h:outputLink value="plotter.xhtml?name=#{_topic.name}"
												styleClass="btn btn-default">Plot</h:outputLink>
											<h:outputLink value="statistics.xhtml?name=#{_topic.name}"
                                                styleClass="btn btn-default">Stats</h:outputLink>
										</div>
									</h:form>

								</h:column>

							</h:dataTable>

						</div>
						<!-- /.table-responsive -->

						<div class="well">
							<h:form id="autoupdate">
								<p:poll widgetVar="autoupdatePoll" interval="3"
									listener="#{progressController.getProgressMap}"
									update="@([id$=orStatus])" autoStart="false" />

								<div class="checkbox">
									<label> <input id="autoupdateCheck" type="checkbox"
										checked="checked"
										onchange="if ($(this).is(':checked')){ PF('autoupdatePoll').start()} else { PF('autoupdatePoll').stop()}"></input>
										Auto-update status (to update the other fields you need to
										refresh this page).
									</label>
								</div>
							</h:form>
						</div>
						<!-- /.well -->

					</div>
					<!-- /.panel-body -->

				</div>
				<!-- /.panel -->
			</div>
			<!-- /.col-lg-12 -->
		</div>
		<!-- /.row -->


		<div class="row">
			<div class="col-lg-12"></div>
			<!-- /.col-lg-12 -->
		</div>
		<!-- /.row -->
	</ui:define>

	<ui:define name="scripts">
		<h:outputScript type="text/javascript">
            
            $(document).ready(function(){
                if ($('#autoupdateCheck').is(':checked')){
                 PF('autoupdatePoll').start();
                 } else { 
                 PF('autoupdatePoll').stop();
                }
        });
        </h:outputScript>
	</ui:define>
</ui:composition>
